# fly.toml app configuration file for n8n-test-poxxba

app = "n8n-test-poxxba"
primary_region = "sin"

[build]
  dockerfile = "Dockerfile"

[env]
  # พื้นฐานการรัน n8n
  N8N_PORT = "5678"
  N8N_PROTOCOL = "https"
  N8N_HOST = "n8n-test-poxxba.fly.dev"
  WEBHOOK_URL = "https://n8n-test-poxxba.fly.dev/"
  GENERIC_TIMEZONE = "Asia/Bangkok"

  # โฟลเดอร์เก็บข้อมูล (จะผูกกับ volume ด้านล่าง)
  N8N_USER_FOLDER = "/home/node/.n8n"

  # auth (อย่าใช้ password นี้ในของจริง เปลี่ยนเองทีหลัง)
  N8N_BASIC_AUTH_ACTIVE = "true"
  N8N_BASIC_AUTH_USER = "admin"
  # N8N_BASIC_AUTH_PASSWORD ให้ตั้งผ่าน fly secrets ดีกว่า

  # ให้ n8n เชื่อ proxy (แก้ warning X-Forwarded-For)
  N8N_TRUSTED_PROXIES = "*"

  # permission config file ให้เข้มขึ้น (ลบ warning permissions ได้)
  N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS = "true"

# ผูก volume เข้ากับโฟลเดอร์ข้อมูลของ n8n
[[mounts]]
  source = "n8n_data"
  destination = "/home/node/.n8n"

[http_service]
  internal_port = 5678
  force_https = true
  auto_start_machines = true
  auto_stop_machines = "stop"   # ถ้าอยาก always-on เปลี่ยนเป็น "off"
  min_machines_running = 0      # ถ้าอยาก always-on เปลี่ยนเป็น 1
  processes = ["app"]

[[vm]]
  memory = "1gb"
  cpu_kind = "shared"
  cpus = 1
  memory_mb = 1024
